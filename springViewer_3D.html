<!DOCTYPE html>
<meta charset="utf-8">
<body>

<link rel="stylesheet" type="text/css" href="scripts_3D/forceLayout_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/selection_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/colorbar_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/settings_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/coexpression_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/diffex_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/cluster_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/bc_box_style.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/sweetalert.css">
<link rel="stylesheet" type="text/css" href="scripts_3D/spring3D_style.css">

<div id="options_bar">
	<div id="color_chooser"> </div>
</div>


<div id="container">
	<div id="force_layout"> </div>
	<div id="frame"> </div>
	<div id="termsheet" class="sidebar">
		<div class="column" id="termcolumn"> </div>
		<div class="column" id="scorecolumn" > </div>
	</div>
	<div id="legend" class="sidebar">
		<div class="column" id="count_column"> </div>
		<div class="column" id="label_column"> </div>
	</div>
	
	<!-- 
		<div id="coexpression_panel" class="sidebar">
		<div id="coexpression_header"> </div>
		<div id="coexpression_legend" ></div>
		<div id="coexpression_infobox"> </div>
		<div id="coexpression_settings_box"> 
			<div > <input type="range" min="5" value="60" max="120" id="coexpression_size_slider"> <p>Point size</p> </div>
			<div> <input type="range" min="0" value="5" max="20" id="coexpression_jitter_slider"> <p>Jitter</p> </div>
			<div> <input type="range" min="0" value="0" max="100" id="coexpression_zoom_slider"> <p>Zoom</p> </div>
		</div>
	</div>
	<div id="diffex_panel" class="sidebar">
		<div id="diffex_header"> </div>
		<div id="diffex_legend_upper" class="diffex_legend"></div>
		<div id="diffex_legend_lower" class="diffex_legend"></div>
		<div id="diffex_infobox"> </div>
		<div id="diffex_settings_box"> 
			<div> <input type="range" min="5" value="60" max="120" id="diffex_size_slider"> <p>Point size</p> </div>
			<div> <input type="range" min="0" value="0" max="20" id="diffex_jitter_slider"> <p>Jitter</p> </div>
			<div> <input type="range" min="0" value="20" max="1600" id="diffex_zoom_slider"> <p>Zoom</p> </div>
		</div>
	</div>
 -->
</div>

	
<div id="create_cluster_box">
	<div id="cluster_button_bar">
		<p> Number of clusters: </p>
		<form name="enter_cluster_number" onSubmit="return false;">
			<input type="text" id="enter_cluster_number" placeholder="?">
		</form>
		<button id="cluster_view_button"> View </button>
		<button id="cluster_apply_button"> Apply </button>
		<button id="cluster_help_choose_button"> Help choose number </button>
		<button id="cluster_explanation_button"> Explanation of method </button>
		<button id="cluster_close_button"> Close </button>
	</div>
	<div id="cluster_plot_window"> </div>
	<div id="cluster_text_window"> </div>
</div>

<div id="update_cluster_labels_box"> 
	<div id="cluster_label_button_bar">
		<button id="close_cluster_label_button"> Close </button>
		<button id="save_legend_button"> Save </button>
		<button id="download_legend_button"> Download legend </button>
	</div>
</div>


<script src="scripts_3D/d3.min.js"></script>
<script src="scripts_3D/jquery-3.1.0.min.js"></script>
<script src="scripts_3D/colorBar.js"></script>
<script src="scripts_3D/forceLayout_script.js"></script>
<script src="scripts_3D/rotation_script.js"></script>
<script src="scripts_3D/selection_script.js"></script>
<script src="scripts_3D/settings_script.js"></script>
<script src="scripts_3D/coexpression_script.js"></script>
<script src="scripts_3D/diffex_script.js"></script>
<script src="scripts_3D/simg.js"></script>
<script src="scripts_3D/jspdf.min.js" ></script>
<script src="scripts_3D/canvg.min.js"></script>
<script src="scripts_3D/FileSaver.js"></script>
<script src="scripts_3D/spin.min.js"></script>
<script src="scripts_3D/sweetalert.min.js"></script>
<script src="scripts_3D/cluster_script.js"></script>
<script src="scripts_3D/bc_box_script.js"></script>
<script src="scripts_3D/html2canvas.js"></script>
<script src="scripts_3D/d3-queue.v3.min.js"></script>
<script src="scripts_3D/graphosaurus.js"></script>



<script>

var rotator_radius = null;

//setup_download_dropdown();
d3.select("#sound_toggle").append('img')
	.attr('src', "scripts_3D/sound_effects/icon_mute.svg")
	.on("click", function() {
		if (d3.select("#sound_toggle").select("img").attr("src") == "scripts_3D/sound_effects/icon_speaker.svg") {
			d3.select("#sound_toggle").select("img").attr("src","scripts_3D/sound_effects/icon_mute.svg"); }
		else { d3.select("#sound_toggle").select("img").attr("src","scripts_3D/sound_effects/icon_speaker.svg"); } });


	
function load_colors(graph_directory,sub_directory) {
	d3.select('#load_colors').remove();
	var base_dir=graph_directory;
	var sub_dir=graph_directory + '/' + sub_directory;
	console.log(base_dir);
	console.log(sub_dir);
	$.ajax({
		url:"cgi-bin/load_counts.py",
		type:"POST",
		data:{base_dir:base_dir},
		success: function(python_data){
			console.log('Got the data');
			//console.log(python_data);
			//colorBar(sub_dir, python_data);
			colorBar(sub_dir, python_data);
		},
	});
}

function load_edges(graph_directory,sub_directory) {
	d3.text(graph_directory + '/' + sub_directory+'/edges.csv',function(text) {
		text.split('\n').forEach(function(line,i) {
			if (line != '' && i % 3==0) {
				line = line.split(';');
				var source = parseInt(line[0]);
				var target = parseInt(line[1]);
				G.edge([node_dict[source],node_dict[target]], {color: '#323232'}).addTo(graph);	
			}	
		});
		graph.renderIn('frame');
	});
	
}

var name = window.location.search;
graph_directory = name.slice(1,name.length);
d3.select("#force_layout").select("svg").remove()
d3.select("#color_chooser").selectAll("div").remove()
d3.select("#color_chooser").selectAll("input").remove()
d3.select("#color_chooser").selectAll("select").remove()
//forceLayout(graph_directory, callback);

var name = window.location.search;
graph_directory = name.slice(1,name.length);
var tmp = graph_directory.split('/');
graph_directory = tmp.slice(0,tmp.length-1).join('/');
sub_directory = tmp[tmp.length-1];


graph = G.graph({
  nodeImage: "stuff/disc_3D.png",
  nodeImageTransparent: true,
  sizeAttenuation: true,
  antialias: true,
  bgColor: '#545454',
  edgeWidth: .1,
  edgeOpacity: 1,
  nodeSize: .1
});


node_dict = {}
base_colors = [];
d3.text(graph_directory + '/' + sub_directory+'/coordinates_3D.txt',function(text) {
	text.split('\n').forEach(function(line,i) {
		if (line != '') {
			line = line.split(',');
			coords = [parseFloat(line[1]),parseFloat(line[2]),parseFloat(line[3])];
			var node = G.node(coords, {id:i, color:'#000000'});
			node_dict[i] = node
			node.name = i;
			node.addTo(graph);
			base_colors.push({r:0, g:0, b:0});
		}
	});
	load_edges(graph_directory,sub_directory);
	load_colors(graph_directory,sub_directory);
});




</script>


</body>

